name: Warm Cache

on:
  # Run daily at 6 AM UTC (midnight CST)
  schedule:
    - cron: '0 6 * * *'

  # Also run after Vercel deploys (via webhook)
  repository_dispatch:
    types: [vercel-deploy]

  # Allow manual trigger
  workflow_dispatch:

jobs:
  warm-cache:
    runs-on: ubuntu-latest
    steps:
      - name: Warm static pages
        run: |
          echo "Warming cache for static pages..."
          BASE_URL="${{ vars.SITE_URL || 'https://cristina8455.vercel.app' }}"

          curl -s -o /dev/null -w "Homepage: %{http_code} (%{time_total}s)\n" "$BASE_URL/"
          curl -s -o /dev/null -w "Courses: %{http_code} (%{time_total}s)\n" "$BASE_URL/courses"
          curl -s -o /dev/null -w "Office Hours: %{http_code} (%{time_total}s)\n" "$BASE_URL/office-hours"
          curl -s -o /dev/null -w "Resources: %{http_code} (%{time_total}s)\n" "$BASE_URL/resources"
          curl -s -o /dev/null -w "About: %{http_code} (%{time_total}s)\n" "$BASE_URL/about"

      - name: Warm Spring 2026 course pages
        run: |
          BASE_URL="${{ vars.SITE_URL || 'https://cristina8455.vercel.app' }}"
          echo ""
          echo "Warming Spring 2026 course pages..."

          # MTH122-008
          curl -s -o /dev/null -w "MTH122-008: %{http_code} (%{time_total}s)\n" "$BASE_URL/courses/spring-2026/mth122-008"
          curl -s -o /dev/null -w "MTH122-008 Syllabus: %{http_code} (%{time_total}s)\n" "$BASE_URL/courses/spring-2026/mth122-008/syllabus"

          # MTH122-202
          curl -s -o /dev/null -w "MTH122-202: %{http_code} (%{time_total}s)\n" "$BASE_URL/courses/spring-2026/mth122-202"
          curl -s -o /dev/null -w "MTH122-202 Syllabus: %{http_code} (%{time_total}s)\n" "$BASE_URL/courses/spring-2026/mth122-202/syllabus"

          # MTH140-201
          curl -s -o /dev/null -w "MTH140-201: %{http_code} (%{time_total}s)\n" "$BASE_URL/courses/spring-2026/mth140-201"
          curl -s -o /dev/null -w "MTH140-201 Syllabus: %{http_code} (%{time_total}s)\n" "$BASE_URL/courses/spring-2026/mth140-201/syllabus"

          echo ""
          echo "Cache warming complete!"
          echo "Note: Individual Day pages are warmed on-demand when visited."
